<!DOCTYPE html>
<html lang="es">
<head>
    <div th:replace="~{fragments/layout :: head(title='Principal')}">

    </div>
    <link rel="stylesheet" href="/css/Inicio.css">
</head>

<body>
<div th:replace="~{fragments/layout :: nav}">

</div>

<a href="#cont_navid" class="btn btn-primary" id="btn_IrArriba">^</a>
<div class="cont_nav justify-content-center" id="cont_navid">
    <div class="item1" id="item1id" sec:authorize="hasAnyRole('ROLE_DOCENTE')">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title card-header">Solicitudes de salida</h5>
                <ul class="list-group list-group-flush">

                    <li class="list-group-item">Conoce el estado de tus solicitudes de salida. Las opciones que puedes elegir son:
                    </li>
                </ul>
                <ul class="list-group list-group-flush">
                    <li class="list-group-item"> > Editar solicitud de salida</li>
                    <li class="list-group-item"> > Ver informacion de tus solicitudes</li>
                    <li class="list-group-item"> > Eliminar tus solicitudes</li>
                </ul>

            </div>
            <div class="card-footer">
                <a href="#opc1" class="btn btn-primary">Conoce mas...</a>
            </div>
        </div>
    </div>


    <div class="item2" id="item2" sec:authorize="hasAnyRole('ROLE_ADMINISTRACIÓN','ROLE_SUBDIRECTOR', 'ROLE_DIRECTOR')">
        <div class="card">
            <div class="card-body ">
                <h5 class="card-title card-header">Subir reporte</h5>
                <ul class="list-group list-group-flush">

                    <li class="list-group-item">
                        Lista de mis reportes de salida que aun se encuentran pendientes por subir
                    </li>
                </ul>
                <ul class="list-group list-group-flush">
                    <li class="list-group-item"> > Ver informacion de las solicitudes</li>
                    <li class="list-group-item"> > Subir reporte de salida en formato PDF</li>
                </ul>
            </div>
            <div class="card-footer">
                <a href="#opc3" class="btn btn-primary">Conoce mas...</a>
            </div>
        </div>
    </div>

    <div class="item3" id="item3" sec:authorize="hasAnyRole('ROLE_ADMINISTRACIÓN','ROLE_SUBDIRECTOR', 'ROLE_DIRECTOR')">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title card-header">Firmar reportes</h5>
                <ul class="list-group list-group-flush">

                    <li class="list-group-item">
                        Mira las solicitudes de salidas que se encuentran pendientes de firmar
                    </li>
                </ul>
                <ul class="list-group list-group-flush">
                    <li class="list-group-item"> > Ver informacion de las solicitudes</li>
                    <li class="list-group-item"> > Firmar solicitudes</li>
                    <li class="list-group-item"> > Rechazar solicitudes</li>
                </ul>
            </div>
            <div class="card-footer">
                <a href="#opc2" class="btn btn-primary">Conoce mas...</a>
            </div>
        </div>
    </div>

</div>
<div class="separadordetablas" id="opc1"></div>

<div class="solicitudContenedor" sec:authorize="hasAnyRole('ROLE_DOCENTE')"><!--CONTENEDOR TABLA SOLICITUDES DE SALIDA-->
    <img class="htmx-indicator" src="https://i.imgur.com/8THYvPQ.gif">
    <div id="result-accion"></div>
    <div id="result-cancelar"></div>
    <h4>Mis solicitudes de salida</h4>
    <table class="table">
        <thead class="table-bordered"><!--ENCABEZADO DE LA TABLA-->
        <tr>
            <th scope="col">Nombre del evento</th>
            <th scope="col">Estado de la solicitud</th>
            <th scope="col">Opciones</th>
        </tr>
        </thead><!--FIN ENCABEZADO DE TABLA-->

        <tbody><!--CUERPO DE LA TABLA-->
        <tr th:each="sol : ${solicitudes}">
            <td th:text="${sol.nombreEvento}"></td>
            <td th:text="${sol.estadoSolicitud}"></td>
            <td>
                <!--                  <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#ModalEditarSolicitud">Editar</button>-->
                <button class="btn btn-dark" data-bs-toggle="modal" data-bs-target="#ModalSolicitudInfo"
                        th:hx-get="'/solicitud?id=' + ${sol.getIdSolicitud}"
                        hx-target="#solicitud-info-body"
                >
                    ver +
                </button>
                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#ModalEditarSolicitud"
                        th:disabled="${sol.idEstadoSolicitud != 1 and sol.idEstadoSolicitud != 7}"
                        th:hx-get="'/docente/get-editar-form?id=' + ${sol.getIdSolicitud}"
                        hx-target="#modal-editar-solicitud-body"
                >Editar</button>
                <button  id="btn_eliminarslc"
                         th:disabled="${sol.idEstadoSolicitud == 5 or sol.idEstadoSolicitud == 6 or sol.idEstadoSolicitud == 8}"
                         th:onclick="'document.getElementById(\'solicitudCancelar\').value = ' + ${sol.getIdSolicitud}"
                         type="button" class="btn btn-warning" data-bs-toggle="modal" data-bs-target="#modalCancelar">x</button>

                <!--                  <button class="btn btn-warning" id="btn_eliminarslc">x</button>-->
            </td>

        </tr>
        <tr>
            <td colspan="2">IMPORTANTE: *Cuentas con 5 dias habiles para entregar el reporte de salida despues de la fecha de regreso*</td>
            <td>
                <button
                        hx-get="/docente/get-registrar-solicitud-form"
                        hx-target="#modal-crear-solicitud-body"
                        class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#ModalCrearSolicitud">
                    Crear nueva solicitud
                </button>

            </td>
        </tr>

        </tbody><!--FIN CUERPO TABLA-->
    </table>
</div><!--FIN CONTENEDOR SOLICITUDES-->

<div class="separadordetablas" id="opc2"></div><!--NO QUITAR LO USO PARA QUE SE ACOMODEN BIEN LAS VISTAS AL USAR LA BARRA DE NAVEGACION-->

<!--MODAL PARA VER INFORMACION DE SOLICITUD-->
<div class="modal fade m1" id="ModalSolicitudInfo" tabindex="-1" role="dialog" aria-labelledby="ModalSolicitudInfoLabel" aria-hidden="false">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content" id="cuadroModal">
            <div class="modal-content" id="tituloModal">
                <h5 class="modal-title" id="ModalSolicitudInfoLabel">
                    <span id="slc_Evento">Nombre del evento</span>
                </h5>

            </div>
            <div class="modal-body" id="solicitud-info-body">

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="quitarModal(ModalSolicitudInfo)">Cerrar</button>
            </div>
        </div>
    </div>
</div>
<!--FIN MODAL VER SOLICITUD INFO-->

<!--MODAL CANCELAR SOLICITUD-->
<!-- Modal -->
<div class="modal fade" id="modalCancelar" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Cancelar Solicitud</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                ¿Desea cancelar esta solicitud?
            </div>
            <form
                    hx-post="/docente/cancelar"
                    hx-target="#result-cancelar"
                    hx-swap="innerHTML"
            >
                <div class="modal-footer">
                    <input type="number" name="solicitudCancelar" id="solicitudCancelar" hidden>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="submit" class="btn btn-primary" data-bs-dismiss="modal">Confirmar</button>
                </div>
            </form>

        </div>
    </div>
</div>
<!-- FIN MODAL CANCELAR SOLICITUD -->

<!--MODAL CREAR SOLICITUD-->
<!-- Modal -->
<div
        hx-swap="outerHTML"
        hx-trigger="resetForm from:body"
        hx-get="/docente/get-registrar-solicitud-form"
        hx-target="#modal-crear-solicitud-body"
>
</div>
<div class="modal fade" id="ModalCrearSolicitud" tabindex="-1" role="dialog" aria-labelledby="ModalCrearSolicitudTitle" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h6 class="modal-title" id="ModalCrearSolicitudTitle">Nueva solicitud</h6>
            </div>
            <div class="modal-body">
                <form hx-post="/docente/registrar"
                      hx-target="#result-msg"
                      id="crearSolictud"
                >
                    <div id="result-msg"></div>

                    <div id="modal-crear-solicitud-body"></div>


                    <div id="miModal" class="modalConfirmar">
                        <div class="modalConfirmar-content">
                            <p>¿Todos los datos son correctos?</p>
                            <button type="button"  class="btn btn-secondary" onclick="cerrarModal()">Cancelar</button>
                            <button class="btn btn-primary" onclick="cerrarModal()" type="submit" >Confirmar</button>
                        </div>
                    </div>
                </form>
                <div class="modal-footer">
                    <button type="button"  class="btn btn-secondary" onclick="quitarModal(ModalCrearSolicitud)">Cerrar</button>
                    <button onclick="validarForm()"  id="buttonCrearSolicitud" class="btn btn-primary">Crear solicitud</button>
                </div>
            </div>
        </div>
    </div>
</div>

<!--FIN MODAL CREAR SOLICITUD-->

<!--MODAL EDITAR SOLICITUD-->
<!-- Modal -->
<div class="modal fade" id="ModalEditarSolicitud" tabindex="-1" role="dialog" aria-labelledby="ModalEditarSolicitudTitle" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h6 class="modal-title" id="ModalEditarSolicitudTitle">Editar solicitud</h6>
            </div>
            <div class="modal-body">
                <form id="form_EditarSolicitud" hx-post="/docente/editar"
                      hx-target="#result-accion"
                      hx-swap="innerHTML"
                      hx-indicator=".htmx-indicator"
                >
                    <div id="result-editar"></div>
                    <div id="modal-editar-solicitud-body"></div>

                    <div id="miModalEditar" class="modalConfirmar">
                        <div class="modalConfirmar-content">
                            <p>¿Desea guardar los cambios?</p>
                            <button type="button"  class="btn btn-secondary" onclick="miModalEditar()">Cancelar</button>
                            <button class="btn btn-primary" data-bs-dismiss="modal" onclick="cerrarModalEditar()" type="submit" >Confirmar</button>
                        </div>
                    </div>
                </form>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="quitarModal(ModalEditarSolicitud)">Cerrar</button>
                    <button onclick="validarFormEditar()" class="btn btn-primary">Guardar Cambios</button>
                </div>
            </div>

        </div>
    </div>
</div>
<!--FIN MODAL EDITAR SOLICITUD-->


<!--CONTENEDOR TABLA SOLICITUDES POR FIRMAR-->
<div id="firmar-result"></div>

<div th:include="~{fragments/solicitud/solicitudes-por-firmar :: solicitudes-por-firmar}"
     hx-swap="innerHTML"
     hx-get="solicitud/por-firmar"
     hx-trigger="refreshSolicitudes from:body"
>

</div>

<!--FIN CONTENEDOR SOLICITUDES POR FIRMAR-->


<!-- MODAL RECHAZAR SOLICITUD -->
<div class="modal fade" id="rechazarSolicitud" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Rechazar Solicitud</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <form
              hx-post="/solicitud/rechazar"
              hx-target="#firmar-result"
              hx-swap="innerHTML"
      >
      <div class="modal-body">
        ¿Seguro que desea rechazar la solicitud '<span id="confirmar-rechazo-evento"></span>'?
      </div>
      <input hidden id="rechazar-solicitud-id" name="rechazarId">

	    <div class="mb-3 mt-3 motivos">
            <p id="motivo-alert" style="color: red; display: none;">Especifique el motivo del rechazo de la solicitud </p>
			  <label for="motivoDescripcion" class="form-label">Motivos:</label>
			  <textarea  name="motivo" class="form-control" id="motivoDescripcion" rows="3"></textarea>
		</div>
      <div class="modal-footer">
        <button type="submit" hidden data-bs-dismiss="modal" id="botonRechazar"></button>
        <button onclick="limpiarModalRechazar();" type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
        <button

        type="button" onclick="validarMotivo();"  class="btn btn-primary">Confirmar</button>
      </div>
      </form>
    </div>
  </div>
</div>
<!-- FIN MODAL RECHAZAR SOLICITUD -->


<!-- MODAL FIRMAR SOLICITUD -->
<div class="modal fade" id="confirmar-firma" tabindex="-1" aria-labelledby="Confirmar Firma" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5">Confirmar firma</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                Desea firmar <span id="confirmar-firma-evento"></span>
                <input type="hidden" id="firmar-solicitud-id" name="solicitudid" value="">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" data-bs-dismiss="modal" id="confirmar-firma-aceptar"
                        hx-post="/solicitud/firmar"
                        hx-include="[name='solicitudid']"
                        hx-target="#firmar-result"
                        hx-swap="innerHTML"
                >
                    Aceptar
                </button>
            </div>
        </div>
    </div>
</div>

<div class="separadordetablas" id="opc3"></div><!--NO QUITAR LO USO PARA QUE SE ACOMODEN BIEN LAS VISTAS AL USAR LA BARRA DE NAVEGACION-->

<div class="reporteSalida" sec:authorize="hasAnyRole('ROLE_ADMINISTRACIÓN','ROLE_SUBDIRECTOR', 'ROLE_DIRECTOR')">
    <h4>Reportes de salida pendientes</h4>
    <table class="table">
        <thead class="table-bordered"><!--ENCABEZADO DE LA TABLA-->
        <tr>
            <th scope="col">Nombre del evento</th>
            <th scope="col">Archivo PDF</th>
            <th scope="col">Opciones</th>
        </tr>
        </thead>
        <tbody>

        <tr>
            <td>Evento 4</td>
            <td><input type="file" accept=".pdf" id="PDF_ReporteSalida" class="form-control"></td>
            <td><button class="btn btn-dark" data-bs-toggle="modal" data-bs-target="#ModalSolicitudInfo">ver +</button></td>
        </tr>
        <tr>
            <td>Evento 5</td>
            <td><input type="file" accept=".pdf" id="PDF_ReporteSalida" class="form-control"></td>
            <td><button class="btn btn-dark" data-bs-toggle="modal" data-bs-target="#ModalSolicitudInfo">ver +</button></td>
        </tr>
        <tr>
            <td>Evento 6</td>
            <td><input type="file" accept=".pdf" id="PDF_ReporteSalida" class="form-control"></td>
            <td><button class="btn btn-dark" data-bs-toggle="modal" data-bs-target="#ModalSolicitudInfo">ver +</button></td>
        </tr>

        </tbody>
    </table>
</div>



<div class="piedepagina">
    <script src="/js/Inicio.js"></script>
</div>
<script>
    const firmarResult = document.getElementById('firmar-result')

    // Crea una instancia de MutationObserver
    const firmarObserver = new MutationObserver((mutationsList, observer) => {
        // Se ejecutará cada vez que haya un cambio en el div
        setTimeout(function() {
            // Elimina el elemento
            firmarResult.innerHTML = "";
        }, 3000); // 3000 milisegundos = 3 segundos
    });
    // Configura las opciones para observar cambios en el contenido del div
    let firmarConfig = { childList: true };

    // Inicia la observación del div con las opciones configuradas
    firmarObserver.observe(firmarResult, firmarConfig);
</script>
</body>
</html>